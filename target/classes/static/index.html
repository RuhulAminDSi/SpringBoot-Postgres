<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <title>User Management</title>
  <style>
    /* Center the main content */
    body, html {
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0;
      font-family: "Times New Roman";
      background-color: #f7f9fc;
    }
    .container {
      text-align: center;
      width: 300px;
      padding: 20px;
      background-color: #ffffff;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    h1 {
      color: #333;
      font-size: 30px;
      padding-bottom: 40px;
    }
    ul {
      list-style-type: none;
      padding: 0;
    }
    li {
      background: #f4f4f4;
      margin: 5px 0;
      padding: 10px;
      border-radius: 5px;
    }
    input[type="text"] {
      width: 100%;
      padding: 8px;
      margin: 8px 0;
      border: 1px solid #cccccc;
      border-radius: 4px;
    }
    button {
      width: 100%;
      padding: 10px;
      color: white;
      background-color: #4CAF50;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    button:hover:not(:disabled) {
      background-color: #45a049;
    }
    .message {
      color: red;
      font-size: 0.9em;
      margin-top: 5px;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>User Management</h1>

  <p class="pb-md-1 text-left text-primary">Users List</p>

  <ul id="userList"></ul>

  <input type="text" id="username" placeholder="Enter username" required onkeypress="if(event.keyCode === 13) addUser()">
  <button onclick="addUser()">Add User</button>

  <input type="text" id="deleteUser" placeholder="Enter user name to delete" oninput="checkUserExists()" onkeypress="if(event.keyCode === 13) deleteUser()">
  <button id="deleteButton" onclick="deleteUser()" disabled>Delete User</button>
  <div id="userNotFound" class="message"></div> <!-- Error message for unavailable user -->
</div>

<script>
  async function fetchUsers() {
    try {
      const response = await fetch('http://localhost:8080/api/users');
      const users = await response.json();
      const userList = document.getElementById('userList');
      userList.innerHTML = '';

      users.forEach(user => {
        const li = document.createElement('li');
        li.innerText = user;
        userList.appendChild(li);
      });
    } catch (error) {
      console.error('Error fetching users:', error);
    }
  }

  async function addUser() {
    const username = document.getElementById('username').value.trim();
    if (!username) {
      alert('Please enter a username.');
      return;
    }
    try {
      const response = await fetch('http://localhost:8080/api/users', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(username),
      });

      const result = await response.text();
      document.getElementById('username').value = ''; // Clear the input
      fetchUsers(); // Refresh the user list
    } catch (error) {
      console.error('Error adding user:', error);
    }
  }

  async function checkUserExists() {
    const userName = document.getElementById('deleteUser').value.trim();
    const response = await fetch('http://localhost:8080/api/users');
    const users = await response.json();

    const userNotFoundMessage = document.getElementById('userNotFound');
    const deleteButton = document.getElementById('deleteButton');

    if (users.includes(userName)) {
      userNotFoundMessage.innerText = ''; // Clear any error message
      deleteButton.disabled = false; // Enable delete button
    } else {
      userNotFoundMessage.innerText = 'User not found';
      deleteButton.disabled = true; // Disable delete button if user doesn't exist
    }
  }

  async function deleteUser() {
    try {
      const userName = document.getElementById('deleteUser').value;
      const response = await fetch(`http://localhost:8080/api/users/${userName}`, {
        method: 'DELETE',
      });
      const message = await response.text();
      document.getElementById('deleteUser').value = ''; // Clear delete field after deletion
      document.getElementById('userNotFound').innerText = ''; // Clear error message
      await fetchUsers(); // Refresh the user list
      document.getElementById('deleteButton').disabled = true; // Disable button after delete
    } catch (error) {
      console.error('No user found', error);
    }
  }

  window.onload = fetchUsers; // Fetch users on page load
</script>
</body>
</html>
